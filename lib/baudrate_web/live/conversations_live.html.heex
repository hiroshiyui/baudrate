<div id="conversations-page" class="conversations-page space-y-4">
  <div class="flex items-center justify-between">
    <h1 id="conversations-heading" class="text-2xl font-bold">{gettext("Messages")}</h1>
    <.link navigate="/messages/new" class="btn btn-primary btn-sm">
      <.icon name="hero-pencil-square" class="size-4" />
      {gettext("New Message")}
    </.link>
  </div>

  <div :if={@conversations == []} class="text-center py-12 text-base-content/70">
    <.icon name="hero-chat-bubble-left-right" class="size-12 mx-auto mb-4 opacity-50" />
    <p class="text-lg">{gettext("No messages yet.")}</p>
    <p class="text-sm">{gettext("Start a conversation from a user's profile page.")}</p>
  </div>

  <div :if={@conversations != []} id="conversations" class="space-y-2" aria-live="polite">
    <.link
      :for={conv <- @conversations}
      id={"conversation-#{conv.id}"}
      navigate={~p"/messages/#{conv.id}"}
      class={[
        "conversation card bg-base-200 shadow-sm hover:bg-base-300 transition-colors cursor-pointer block",
        Map.get(@muted_conversations, conv.id, false) && "opacity-50"
      ]}
    >
      <div class="card-body p-4 flex flex-row items-center gap-3">
        <% other = other_participant(conv, @current_user) %>
        <%= case other do %>
          <% %Baudrate.Setup.User{} = user -> %>
            <.avatar user={user} size={36} />
          <% _ -> %>
            <div class="avatar avatar-placeholder">
              <div
                class="bg-neutral text-neutral-content rounded-full"
                style="width: 36px; height: 36px"
              >
                <span class="text-sm">
                  {String.first(participant_name(other)) |> String.upcase()}
                </span>
              </div>
            </div>
        <% end %>
        <div class="flex-1 min-w-0">
          <div class="flex items-center justify-between">
            <span class="font-semibold truncate">{participant_name(other)}</span>
            <span :if={conv.last_message_at} class="text-xs text-base-content/70 shrink-0 ml-2">
              {format_relative_time(conv.last_message_at)}
            </span>
          </div>
        </div>
        <div
          :if={
            Map.get(@unread_counts, conv.id, 0) > 0 and
              not Map.get(@muted_conversations, conv.id, false)
          }
          class="badge badge-primary badge-sm"
        >
          {Map.get(@unread_counts, conv.id, 0)}
        </div>
      </div>
    </.link>
  </div>
</div>
